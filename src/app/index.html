<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8" /><link rel="icon" type="image/svg+xml" href="./vite.svg" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><title>screen</title>  <script type="module" crossorigin>(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();const e=()=>typeof window>`u`?!1:window.navigator.userAgentData?.platform?window.navigator.userAgentData.platform.toLowerCase()===`windows`:window.navigator.userAgent.toLowerCase().includes(`windows`);var t=null;function n(){window.app.exit()}async function r(){return t||(t=new Promise((e,t)=>{(async()=>{try{let{width:t,height:n,arrayBuffer:r}=await window.app.getImage();e({imageData:new ImageData(new Uint8ClampedArray(r),t,n),height:n,width:t})}catch(e){t(e)}})()}),t)}const i=({startX:e,startY:t,moveX:n,moveY:r,maxX:i,maxY:a})=>n>=0&&r>=0?{top:t,left:e,width:Math.min(i,n),height:Math.min(a,r)}:n<0&&r>=0?{top:t,left:e+n,width:Math.min(i,-n),height:Math.min(a,r)}:n>=0&&r<0?{top:t+r,left:e,width:Math.min(i,n),height:Math.min(a,-r)}:{top:t+r,left:e+n,width:Math.min(i,-n),height:Math.min(a,-r)},a=({resizeHandle:e,x:t,y:n,width:r,height:i})=>{switch(e){case`resize-top-left`:return{x:t+r,y:n+i};case`resize-top`:case`resize-top-right`:return{x:t,y:n+i};case`resize-right`:case`resize-bottom-right`:case`resize-bottom`:return{x:t,y:n};case`resize-bottom-left`:case`resize-left`:return{x:t+r,y:n};default:return{x:t,y:n}}},o=({resizeHandle:e,fixedX:t,fixedY:n,originWidth:r,originHeight:a,moveX:o,moveY:s,maxX:c,maxY:l})=>{let u=o,d=s;switch(e){case`resize-top-left`:u=o-r,d=s-a;break;case`resize-top`:u=r,d=s-a;break;case`resize-top-right`:u=o+r,d=s-a;break;case`resize-right`:u=o+r,d=a;break;case`resize-bottom-right`:u=o+r,d=s+a;break;case`resize-bottom`:u=r,d=s+a;break;case`resize-bottom-left`:u=o-r,d=s+a;break;case`resize-left`:u=o-r,d=a;break;default:break}return i({startX:t,startY:n,moveX:u,moveY:d,maxX:c,maxY:l})},s=({x:e,y:t,windows:n})=>n.find(n=>e>=n.x&&e<=n.x+n.width&&t>=n.y&&t<=n.y+n.height),c=({x:t,y:n,width:r,height:i})=>{let a=e()?t/C:t,o=e()?n/C:n,s=e()?r/C:r,c=e()?i/C:i,l=window.innerWidth,u=window.innerHeight,d=Math.min(a+s,l),f=Math.min(o+c,u),p=Math.max(a,0),m=Math.max(o,0);return{x:p,y:m,width:d-p,height:f-m}};function l(){return`${Math.random().toString(36).substring(2,10)}-${Math.random().toString(36).substring(2,10)}-${Math.random().toString(36).substring(2,10)}`}function u(e,t,n,r,i){let a=[],o=n*n,s=Math.max(0,Math.ceil(e-n)),c=Math.min(r,Math.floor(e+n)),l=Math.max(0,Math.ceil(t-n)),u=Math.min(i,Math.floor(t+n));for(let n=l;n<=u;n++){let r=n-t;for(let t=s;t<=c;t++){let i=t-e;i*i+r*r<=o&&a.push({x:t,y:n})}}return a}function d(e,t,n,r,i){let a=[],o=n-e,s=r-t,c=Math.sqrt(o*o+s*s),l=2*i*.7,u=Math.max(2,Math.ceil(c/l));for(let n=0;n<u;n++){let r=n/u,i=e+o*r,c=t+s*r;a.push({x:i,y:c})}return a.push({x:n,y:r}),a}function f(e,{width:t,height:n}){e.width=t*C,e.height=n*C,e.style.width=`${t}px`,e.style.height=`${n}px`;let r=e.getContext(`2d`);r.scale(C,C),r.imageSmoothingEnabled=!0,r.imageSmoothingQuality=`high`}function p({x1:e,y1:t,x2:n,y2:r},{maxX:i,maxY:a}){let o=Math.min(e,n),s=Math.min(Math.max(e,n),i),c=Math.min(t,r),l=Math.min(Math.max(t,r),a),u=s-o,d=l-c;return{centerX:o+u/2,centerY:c+d/2,radiusX:u/2,radiusY:d/2,isCircle:Math.abs(u-d)<2,left:o,top:c,width:u,height:d}}function m({x1:e,y1:t,x2:n,y2:r},{maxX:i,maxY:a}){let o=Math.min(e,n),s=Math.min(Math.max(e,n),i),c=Math.min(t,r),l=Math.min(Math.max(t,r),a);return{x:o,y:c,width:s-o,height:l-c}}function h(e,t){e.strokeStyle=t.pen.color,e.lineWidth=t.pen.lineWidth,e.strokeRect(t.attr.x,t.attr.y,t.attr.width,t.attr.height)}function g(e,t){e.strokeStyle=t.pen.color,e.lineWidth=t.pen.lineWidth;let n=t.attr.centerX,r=t.attr.centerY,i=t.attr.radiusX,a=t.attr.radiusY;e.beginPath(),e.ellipse(n,r,i,a,0,0,Math.PI*2),e.stroke()}function _(e,t){if(console.log(`ðŸš€ ~ drawPath ~ shape.attr.path.length:`,t.attr.path.length),!(t.attr.path.length<2)){e.strokeStyle=t.pen.color,e.lineWidth=t.pen.lineWidth,e.beginPath(),e.moveTo(t.attr.path[0].x,t.attr.path[0].y);for(let n=1;n<t.attr.path.length;n++)e.lineTo(t.attr.path[n].x,t.attr.path[n].y);e.stroke()}}function v(e,t){e.strokeStyle=t.pen.color,e.lineWidth=t.pen.lineWidth;let{fromX:n,fromY:r,toX:i,toY:a}=t.attr;e.beginPath();let o=Math.PI/12,s=Math.atan2(a-r,i-n),c=Math.sqrt((i-n)**2+(a-r)**2);e.moveTo(n,r);let l=Math.min(20,c*.5),u=i-Math.cos(s)*(l-2),d=a-Math.sin(s)*(l-2);e.lineTo(u,d),e.stroke(),e.beginPath(),e.moveTo(i,a);let f=i-l*Math.cos(s-o),p=a-l*Math.sin(s-o),m=i-l*Math.cos(s+o),h=a-l*Math.sin(s+o);e.lineTo(f,p),e.lineTo(m,h),e.closePath(),e.fillStyle=t.pen.color,e.fill()}function y(e,t){switch(t.shape){case`rect`:h(e,t);break;case`circle`:g(e,t);break;case`path`:_(e,t);break;case`arrow`:v(e,t);break}}const b=(e,t)=>{let n=!1,r=!1,i=t=>{(t.target===e||e.contains(t.target))&&(r=!0,n=!1)},a=e=>{r&&!n&&t(e),r=!1,n=!1},o=()=>{r&&(n=!0)},s=()=>{r&&(n=!0)};return document.addEventListener(`mousedown`,i),document.addEventListener(`mousemove`,s),document.addEventListener(`mouseup`,a),document.addEventListener(`mouseleave`,o),()=>{document.removeEventListener(`mousedown`,i),document.removeEventListener(`mousemove`,s),document.removeEventListener(`mouseup`,a),document.removeEventListener(`mouseleave`,o)}},x=(e,t)=>{let n=0;return b(e,e=>{n++,n===2?(t(e),n=0):setTimeout(()=>{n=0},300)})},S=[`resize-top-left`,`resize-top`,`resize-top-right`,`resize-right`,`resize-bottom-right`,`resize-bottom`,`resize-bottom-left`,`resize-left`],C=window.devicePixelRatio;var w=e()?10:10*C,T=class{imageData;drawData;canvas;cache=new Map;width;height;constructor({imgData:e,canvas:t}){this.imageData=e,this.canvas=t,this.width=e.width,this.height=e.height,this.drawData=this.canvas.getContext(`2d`).getImageData(0,0,this.width,this.height)}getMosaicColor({y:e,x:t,cx:n,cy:r,r:i}){let a=Math.floor(t/w),o=Math.floor(e/w),s=`${a},${o}`;if(this.cache.has(s))return this.cache.get(s);let c=a*w,l=o*w,u=Math.min(this.width,c+w),d=Math.min(this.height,l+w),f=i*i,p=this.imageData.data,m=0,h=0,g=0,_=0,v=0;for(let e=l;e<d;e++){let t=e-r,i=t*t;for(let t=c;t<u;t++){let r=t-n;if(r*r+i<=f){let n=(e*this.width+t)*4;m+=p[n],h+=p[n+1],g+=p[n+2],_+=p[n+3],v++}}}let y;return y=v>0?{r:Math.floor(m/v),g:Math.floor(h/v),b:Math.floor(g/v),a:Math.floor(_/v)}:{r:0,g:0,b:0,a:0},this.cache.set(s,y),y}drawMosaicForCircle({cx:e,cy:t,r:n,fresh:r=!1}){u(e*C,t*C,n*C,this.imageData.width,this.imageData.height).forEach(({x:r,y:i})=>{let a=this.getMosaicColor({x:r,y:i,cx:e*C,cy:t*C,r:n*C});a&&(this.drawData.data[i*this.width*4+r*4]=a.r,this.drawData.data[i*this.width*4+r*4+1]=a.g,this.drawData.data[i*this.width*4+r*4+2]=a.b,this.drawData.data[i*this.width*4+r*4+3]=a.a)}),r&&this.canvas.getContext(`2d`).putImageData(this.drawData,0,0)}drawMosaic(e){let{path:t,radius:n}=e.attr;t.forEach(({x:e,y:t})=>{this.drawMosaicForCircle({cx:e,cy:t,r:n})}),this.canvas.getContext(`2d`).putImageData(this.drawData,0,0)}clearMosaic(){this.canvas.getContext(`2d`).clearRect(0,0,this.width,this.height),this.drawData=this.canvas.getContext(`2d`).getImageData(0,0,this.width,this.height)}},E=class{dom;constructor(){this.dom=document.createElement(`div`),this.dom.classList.add(`resize-assist`),this.dom.style.display=`none`,S.forEach(e=>{let t=document.createElement(`div`);t.classList.add(`resize-assist-handle`,e),t.dataset.role=e,this.dom.appendChild(t)}),document.body.appendChild(this.dom)}show(){this.dom.style.display=`block`}hide(){this.dom.style.display=`none`}setPosition({top:e,left:t,width:n,height:r}){this.dom.style.top=`${e}px`,this.dom.style.left=`${t}px`,this.dom.style.width=`${n}px`,this.dom.style.height=`${r}px`}},D=class{lastImg=null;baseCanvas;mosaicCanvas;editCanvas;baseCtx;mosaicCtx;editCtx;mosaic=null;_mode=`normal`;resizeAssist;drawState=null;shapeArr=[];currentDrawPos={x1:0,y1:0,x2:0,y2:0};drawing=!1;get mode(){return this._mode}set mode(e){this._mode!==e&&(this._mode=e)}constructor(){this.baseCanvas=document.createElement(`canvas`),this.mosaicCanvas=document.createElement(`canvas`),this.editCanvas=document.createElement(`canvas`),this.baseCtx=this.baseCanvas.getContext(`2d`),this.mosaicCtx=this.mosaicCanvas.getContext(`2d`),this.editCtx=this.editCanvas.getContext(`2d`),this.baseCanvas.style.position=`absolute`,this.mosaicCanvas.style.position=`absolute`,this.editCanvas.style.position=`absolute`,this.baseCanvas.style.top=`0px`,this.baseCanvas.style.left=`0px`,this.mosaicCanvas.style.top=`0px`,this.mosaicCanvas.style.left=`0px`,this.editCanvas.style.left=`0px`,this.editCanvas.style.left=`0px`,this.resizeAssist=new E,console.log(`editCanvas created`,this.resizeAssist),window.editCanvas=this}getCanvasPos=(e,t)=>this.lastImg?{x:Math.min(Math.max(e-this.lastImg.x,0),this.lastImg.x+this.lastImg.width),y:Math.min(Math.max(t-this.lastImg.y,0),this.lastImg.y+this.lastImg.height)}:{x:0,y:0};initListener=()=>{this.editCanvas.addEventListener(`mousedown`,e=>{if(this.mode===`normal`)return;let{x:t,y:n}=this.getCanvasPos(e.clientX,e.clientY);this.currentDrawPos={x1:t,y1:n,x2:t,y2:n},this.drawing=!0}),document.body.addEventListener(`mousemove`,e=>{if(this.mode!==`normal`&&this.drawing){let{x:t,y:n}=this.getCanvasPos(e.clientX,e.clientY);switch(this.currentDrawPos.x2=t,this.currentDrawPos.y2=n,this.drawState?.shape){case`rect`:let e=m(this.currentDrawPos,{maxX:this.lastImg.width,maxY:this.lastImg.height});this.drawState.attr=e,this.renderAll();break;case`circle`:let r=p(this.currentDrawPos,{maxX:this.lastImg.width,maxY:this.lastImg.height});this.drawState.attr=r,this.renderAll();break;case`path`:this.drawState.attr.path.length||this.drawState.attr.path.push({x:this.currentDrawPos.x1,y:this.currentDrawPos.y1}),this.drawState.attr.path.push({x:t,y:n}),this.renderPreview();break;case`mosaic`:if(console.log(`%cðŸŽ„ mosaic`,`background-color: #00b548; color: #fff;padding: 2px 4px;border-radius: 2px;`,t,n,this.mosaic),!this.drawState.attr.path.length)this.drawState.attr.path.push({x:this.currentDrawPos.x1,y:this.currentDrawPos.y1}),this.mosaic?.drawMosaicForCircle({cx:this.currentDrawPos.x1,cy:this.currentDrawPos.y1,r:this.drawState.attr.radius,fresh:!0});else{let e=this.drawState.attr.path[this.drawState.attr.path.length-1],r=d(e.x,e.y,t,n,this.drawState.attr.radius);for(let e=1;e<r.length;e++){let t=r[e];this.drawState.attr.path.push({x:t.x,y:t.y}),this.mosaic?.drawMosaicForCircle({cx:t.x,cy:t.y,r:this.drawState.attr.radius,fresh:!0})}}break;case`arrow`:this.drawState.attr={fromX:this.currentDrawPos.x1,fromY:this.currentDrawPos.y1,toX:this.currentDrawPos.x2,toY:this.currentDrawPos.y2},this.renderAll();break;default:break}}}),document.body.addEventListener(`mouseup`,e=>{console.log(`ðŸš€ ~ EditCanvas ~ e:`,e),this.mode!==`normal`&&this.drawing&&this.drawState&&(this.drawing=!1,(this.currentDrawPos.x1!==this.currentDrawPos.x2||this.currentDrawPos.y1!==this.currentDrawPos.y2)&&(e.preventDefault(),e.stopPropagation(),this.shapeArr.push(this.drawState),this.setShape(this.drawState.shape)))})};initCanvasSetting(e,t){f(this.baseCanvas,{width:e,height:t}),f(this.mosaicCanvas,{width:e,height:t}),f(this.editCanvas,{width:e,height:t})}setParentDom(e){e.appendChild(this.baseCanvas),e.appendChild(this.mosaicCanvas),e.appendChild(this.editCanvas)}setMode(e){this.mode=e}getCtx(){return this.editCtx}async generateImageData(){this.baseCtx.drawImage(this.mosaicCanvas,0,0,this.mosaicCanvas.width,this.mosaicCanvas.height,0,0,this.lastImg.width,this.lastImg.height),this.baseCtx.drawImage(this.editCanvas,0,0,this.editCanvas.width,this.editCanvas.height,0,0,this.lastImg.width,this.lastImg.height);let e=this.baseCtx.getImageData(0,0,this.lastImg.width*C,this.lastImg.height*C);return Promise.resolve(e)}writeToClipboard=async()=>{console.log(`writeToClipboard`);let e=await this.generateImageData();await window.app.copyToClipboard(e),window.app.exit()};saveImageToFolder=async()=>{console.log(`saveImageToFolder`);let e=await this.generateImageData();(await window.app.saveImageToFolder(e)).status===201||window.app.exit()};setImg({img:e,x:t=0,y:n=0,width:r,height:i}){if(this.lastImg&&this.lastImg.x===t&&this.lastImg.y===n&&this.lastImg.width===r&&this.lastImg.height===i)return;let a=performance.now(),o=e.getContext(`2d`).getImageData(t*C,n*C,r*C,i*C);this.baseCtx.putImageData(o,0,0);let s=performance.now();console.log(`drawImage cost ${s-a} ms`),this.lastImg={x:t,y:n,width:r,height:i},this.initListener(),this.mosaic=new T({imgData:o,canvas:this.mosaicCanvas})}setShape(e=`rect`){switch(e){case`rect`:this.drawState={id:l(),shape:`rect`,attr:{x:0,y:0,width:0,height:0},pen:{color:`#ff0000`,lineWidth:2}};break;case`circle`:this.drawState={id:l(),shape:`circle`,attr:{centerX:0,centerY:0,radiusX:0,radiusY:0,isCircle:!1,left:0,top:0,width:0,height:0},pen:{color:`#ff0000`,lineWidth:2}};break;case`path`:this.drawState={id:l(),shape:`path`,attr:{path:[]},pen:{color:`#ff0000`,lineWidth:2}};break;case`mosaic`:this.drawState={id:l(),shape:`mosaic`,attr:{path:[],radius:10}};break;case`arrow`:this.drawState={id:l(),shape:`arrow`,attr:{fromX:0,fromY:0,toX:0,toY:0},pen:{color:`#ff0000`,lineWidth:2}};break;default:this.drawState=null;break}}renderAll=()=>{this.editCtx.clearRect(0,0,this.editCanvas.width,this.editCanvas.height),this.shapeArr.forEach(e=>{y(this.editCtx,e)}),this.renderPreview()};renderPreview=()=>{this.currentDrawPos.x1===this.currentDrawPos.x2&&this.currentDrawPos.y1===this.currentDrawPos.y2||this.drawState&&y(this.editCtx,this.drawState)}};const O=[{id:`rect`,className:`box-select rect`,content:`<div class="wrap"><svg width="19" height="19" viewBox="0 0 19 19" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="0.75" y="0.75" width="16.8" height="16.8" rx="1.2" stroke="var(--active-color)" stroke-width="1.5"/></svg></div>`,role:`edit`,shape:`rect`,group:`edit`},{id:`circle`,className:`box-select circle`,content:`<div class="wrap"><svg width="19" height="19" viewBox="0 0 19 19" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="0.75" y="0.75" width="16.8" height="16.8" rx="8.4" stroke="var(--active-color)" stroke-width="1.5"/></svg></div>`,role:`edit`,shape:`circle`,group:`edit`},{id:`arrow`,className:`box-select arrow`,content:`<div class="wrap"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.7998 20.0732L20.0733 4.79974" stroke="var(--active-color)" stroke-width="1.5" stroke-linecap="round"/><path d="M20.4082 12.9833L20.4082 4.5752L12.0001 4.57519" stroke="var(--active-color)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div>`,role:`edit`,shape:`arrow`,group:`edit`},{id:`path`,className:`box-select path`,content:`<div class="wrap"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.1815 3.68472C15.8482 3.01806 16.1815 2.68472 16.5957 2.68472C17.0099 2.68472 17.3433 3.01805 18.0099 3.68472L20.3137 5.9885C20.9804 6.65516 21.3137 6.9885 21.3137 7.40271C21.3137 7.81692 20.9804 8.15026 20.3137 8.81692L9.00331 20.1273C8.72319 20.4074 8.58313 20.5475 8.40558 20.6234C8.22803 20.6993 8.03001 20.7037 7.63396 20.7126L3.60427 20.803C3.40788 20.8074 3.30968 20.8096 3.24923 20.7492C3.18879 20.6887 3.19099 20.5905 3.1954 20.3941L3.28582 16.3645C3.29471 15.9684 3.29915 15.7704 3.37504 15.5928C3.45093 15.4153 3.59098 15.2752 3.8711 14.9951L15.1815 3.68472Z" stroke="var(--active-color)" stroke-width="1.5"/><line x1="13.6153" y1="4.63373" x2="19.4763" y2="10.4948" stroke="var(--active-color)" stroke-width="1.5"/></svg></div>`,role:`edit`,shape:`path`,group:`edit`},{id:`mosaic`,className:`box-select mosaic`,content:`<div class="wrap"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3.59961" y="3.59961" width="16.8" height="16.8" rx="1" stroke="var(--active-color)" stroke-width="1.5"/><rect x="10.2002" y="10.2002" width="3.6" height="3.6" rx="0.2" fill="var(--active-color)"/><rect x="13.7998" y="6.59961" width="3.6" height="3.6" rx="0.2" fill="var(--active-color)"/><rect x="6.59961" y="6.59961" width="3.6" height="3.6" rx="0.2" fill="var(--active-color)"/><rect x="6.59961" y="13.7998" width="3.6" height="3.6" rx="0.2" fill="var(--active-color)"/><rect x="13.7998" y="13.7998" width="3.6" height="3.6" rx="0.2" fill="var(--active-color)"/></svg></div>`,role:`edit`,shape:`mosaic`,group:`edit`},{id:`undo`,className:`undo`,content:`<div class="wrap"><svg class="normal" style="display: block;" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.3245 19.7779H15.3382C18.4533 19.7779 20.9786 17.2526 20.9786 14.1375C20.9786 11.0224 18.4533 8.49707 15.3382 8.49707H3.43066" stroke="#DBDEE5" stroke-width="1.5" stroke-linecap="round"/><path d="M7.85079 3.27421L2.62793 8.49707L7.85079 13.7199" stroke="#DBDEE5" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="active" style="display: none;" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.3245 19.7779H15.3382C18.4533 19.7779 20.9786 17.2526 20.9786 14.1375C20.9786 11.0224 18.4533 8.49707 15.3382 8.49707H3.43066" stroke="#0D1324" stroke-width="1.5" stroke-linecap="round"/><path d="M7.85079 3.27421L2.62793 8.49707L7.85079 13.7199" stroke="#0D1324" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg></div>`,role:`undo`,group:`operation`},{id:`download`,className:`download`,content:`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12.75 2.71387C12.75 2.29965 12.4142 1.96387 12 1.96387C11.5858 1.96387 11.25 2.29965 11.25 2.71387L12 2.71387L12.75 2.71387ZM11.4697 17.3372C11.7626 17.6301 12.2374 17.6301 12.5303 17.3372L17.3033 12.5642C17.5962 12.2713 17.5962 11.7964 17.3033 11.5035C17.0104 11.2106 16.5355 11.2106 16.2426 11.5035L12 15.7462L7.75736 11.5035C7.46447 11.2106 6.98959 11.2106 6.6967 11.5035C6.40381 11.7964 6.40381 12.2713 6.6967 12.5642L11.4697 17.3372ZM12 2.71387L11.25 2.71387L11.25 16.8068L12 16.8068L12.75 16.8068L12.75 2.71387L12 2.71387Z" fill="#0D1324"/><line x1="2.5498" y1="20.5361" x2="21.4498" y2="20.5361" stroke="#0D1324" stroke-width="1.5" stroke-linecap="round"/></svg>`,role:`download`,group:`operation`},{id:`cancel`,className:`cancel`,content:`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M19.4821 4.46875L4.41895 19.5319" stroke="#FE4343" stroke-width="1.5" stroke-linecap="round"/><path d="M19.5807 19.5319L4.51758 4.46875" stroke="#FE4343" stroke-width="1.5" stroke-linecap="round"/></svg>`,role:`cancel`,group:`operation`},{id:`finish`,className:`finish`,content:`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20.7379 4.92676L10.9616 17.6765C10.2749 18.572 9.93156 19.0198 9.44463 19.0692C8.95771 19.1187 8.53133 18.7491 7.67858 18.01L3.2627 14.1824" stroke="#32C872" stroke-width="1.5" stroke-linecap="round"/></svg>`,role:`finish`,group:`operation`}];var k=40,A=class{dom;itemListeners=new Map;_active=``;_undoActive=!1;get active(){return this._active}set active(e){this.dom.querySelector(`.edit-tool-item.active`)?.classList.remove(`active`),e&&this.dom.querySelector(`.edit-tool-item[data-shape="${e}"]`)?.classList.add(`active`),this._active=e}get undoActive(){return this._undoActive}set undoActive(e){this._undoActive!==e&&(this._undoActive=e,e?(this.dom.querySelector(`.edit-tool-item.undo .active`).style.display=`block`,this.dom.querySelector(`.edit-tool-item.undo .normal`).style.display=`none`):(this.dom.querySelector(`.edit-tool-item.undo .normal`).style.display=`block`,this.dom.querySelector(`.edit-tool-item.undo .active`).style.display=`none`))}constructor(e){this.dom=document.createElement(`div`),this.dom.classList.add(`edit-tool`),this.dom.style.visibility=`hidden`,this.dom.style.height=`${k}px`;let t=e||document.body;t&&t.appendChild(this.dom),this.initItems(),this.initListeners()}initItems=()=>{let e={};O.forEach(t=>{let n=t.group||``;e[n]||(e[n]=document.createElement(`div`),e[n].classList.add(`edit-tool-group`),e[n].dataset.group=n,this.dom.appendChild(e[n]));let r=document.createElement(`div`);r.classList.add(`edit-tool-item`,...t.className.split(` `)),r.innerHTML=t.content||``,r.dataset.role=t.role||``,r.dataset.shape=t.shape||``,e[n].appendChild(r)})};initListeners=()=>{this.dom.addEventListener(`click`,e=>{let t=e.target;for(;t&&!t.classList.contains(`edit-tool-item`)&&(t=t.parentElement,t!==this.dom););if(!t)return;let n=t.dataset.role||``,r=t.dataset.shape||void 0,i=this.itemListeners.get(n);i&&i(r)})};addListener=e=>{e.forEach(e=>{this.itemListeners.set(e.role,e.listener)})};render=(e=!0,{x:t,y:n,height:r,width:i})=>{if(!e){this.dom.style.visibility=`hidden`;return}if(this.dom){this.dom.style.visibility=`visible`,this.dom.style.left=`${t+i-this.dom.clientWidth}px`;let e=window.innerHeight;if(n+r+32+8<=e){this.dom.style.top=`${n+r+8}px`;return}if(n-32-8>=0){this.dom.style.top=`${n-32-8}px`;return}this.dom.style.top=`${n+r-32-8}px`}}},j=class{dom;constructor(e){this.dom=document.createElement(`div`),this.dom.classList.add(`size-display`),e.appendChild(this.dom)}render=(e=!0,{x:t,y:n,height:r,width:i})=>{if(!e||!r&&!i){this.dom.style.visibility=`hidden`;return}this.dom.style.visibility=`visible`,this.dom.style.left=`${t}px`,n-20-8<0?this.dom.style.top=`${n+8}px`:this.dom.style.top=`${n-20-8}px`,this.dom.innerText=`${i*C} x ${r*C}`}},M=class{sizeDisplay;editTools;editCanvas;imgDom;canvasContainer=document.createElement(`div`);baseCanvas=document.createElement(`canvas`);maskCanvas=document.createElement(`canvas`);baseCtx;maskCtx;selectRectDom;isSelecting=!1;resizeHandle=``;startX=0;startY=0;fixedX=0;fixedY=0;fixedWidth=0;fixedHeight=0;selectX=0;selectY=0;selectWidth=0;selectHeight=0;broadcastChannel=new BroadcastChannel(`broadcast`);id=Math.random().toString(36).substring(2);matchedWindow=void 0;_mode=`select`;get mode(){return this._mode}set mode(e){let t=this._mode;if(t!==e)switch(this._mode=e,e){case`waitEdit`:this.canvasContainer.style.cursor=``,this.selectRectDom.style.cursor=`move`;break;case`move`:this.canvasContainer.style.cursor=`move`;break;case`edit`:this.canvasContainer.style.cursor=``,this.selectRectDom.style.cursor=`crosshair`,this.canvasContainer.classList.add(`edit-mode`),this.broadcastChannel.postMessage({type:`startEdit`,id:this.id});break;case`forbidden`:this.clearSelectRect();break;case`otherTab`:if(t===`waitEdit`)break;this.clearSelectRect();break}}imgNaturalWidth=0;imgNaturalHeight=0;imgDrawWidth=0;imgDrawHeight=0;boxWidth=0;boxHeight=0;imgOffsetX=0;imgOffsetY=0;windows=[];constructor(e){console.log(`%cðŸ“ DPR: ${C}`,`background-color: #fc5531; color: #fff;padding: 2px 4px;border-radius: 2px;`),this.imgDom=null,this.canvasContainer.classList.add(`canvas-container`),this.maskCanvas.classList.add(`mask-canvas`),this.maskCtx=this.maskCanvas.getContext(`2d`),this.baseCtx=this.baseCanvas.getContext(`2d`),this.editCanvas=new D,this.selectRectDom=document.createElement(`div`),this.selectRectDom.classList.add(`select-rect`),e.appendChild(this.canvasContainer),this.canvasContainer.appendChild(this.baseCanvas),this.canvasContainer.appendChild(this.maskCanvas),S.forEach(e=>{let t=document.createElement(`div`);t.classList.add(`resize-handle`,e),t.dataset.role=e,this.selectRectDom.appendChild(t)}),this.initData(),this.drawMask(),this.initListener(),this.sizeDisplay=new j(this.canvasContainer),this.editTools=new A,this.editTools.addListener([{role:`edit`,listener:e=>{this.setEditCanvasBg(),this.editCanvas.setMode(`edit`);let t=e===this.editTools.active?``:e||``;this.editCanvas.setShape(t),this.editTools.active=t}},{role:`download`,listener:()=>{this.setEditCanvasBg(),this.editCanvas.saveImageToFolder()}},{role:`finish`,listener:()=>{this.setEditCanvasBg(),this.editCanvas.writeToClipboard()}},{role:`cancel`,listener:()=>{n()}}]),window.app?.getWindows?.().then(e=>{let t=window.innerWidth,n=window.innerHeight,r=[];e.forEach(t=>{if(console.log(`ðŸš€ ~ DrawScreen ~ constructor ~ windows:`,e),t.name!==`tao window`){let{x:e,y:n,width:i,height:a}=t.bounds;r.push(c({x:e,y:n,width:i,height:a}))}}),r.push({x:0,y:0,width:t,height:n}),this.windows=r}).catch(e=>console.error(e)),this.broadcastChannel.onmessage=e=>{let{type:t,id:n,x:r,y:i,act:a}=e?.data||{};a===`selectStart`&&n!==this.id&&(this.selectHeight||this.selectWidth)&&(console.log(`%cðŸ“ clearSelectRect`,`background-color: #fc5531; color: #fff;padding: 2px 4px;border-radius: 2px;`),this.clearSelectRect()),t===`activeWindow`&&n!==this.id?this.mode=`otherTab`:t===`activeWindow`&&n===this.id&&this.mode===`otherTab`?this.mode=`select`:t===`startEdit`&&n&&n!==this.id&&(this.mode=`forbidden`)}}clearSelectRect=()=>{this.selectX=0,this.selectY=0,this.selectWidth=0,this.selectHeight=0,this.drawMask(),this.editTools.render(!1,{x:0,y:0,height:0,width:0}),this.sizeDisplay.render(!1,{x:0,y:0,height:0,width:0})};setImgDom=e=>{this.imgDom=e,this.imgNaturalWidth=this.imgDom.naturalWidth,this.imgNaturalHeight=this.imgDom.naturalHeight;let t=this.imgNaturalWidth/this.boxWidth,n=this.imgNaturalHeight/this.boxHeight,r=Math.max(t,n);this.imgDrawWidth=this.imgNaturalWidth/r,this.imgDrawHeight=this.imgNaturalHeight/r,this.imgOffsetX=(this.boxWidth-this.imgDrawWidth)/2,this.imgOffsetY=(this.boxHeight-this.imgDrawHeight)/2,this.drawBase()};setEditCanvasBg=()=>{this.mode!==`edit`&&(this.mode=`edit`,this.editCanvas.initCanvasSetting(this.selectWidth,this.selectHeight),this.editCanvas.setParentDom(this.selectRectDom),this.editCanvas.setImg({img:this.baseCanvas,x:this.selectX,y:this.selectY,width:this.selectWidth,height:this.selectHeight}))};drawBase=()=>{if(!this.imgDom){console.error(`Image dom is not set`);return}this.baseCtx.drawImage(this.imgDom,0,0,this.imgNaturalWidth,this.imgNaturalHeight,this.imgOffsetX,this.imgOffsetY,this.imgDrawWidth,this.imgDrawHeight)};initData=()=>{this.boxWidth=this.canvasContainer.clientWidth,this.boxHeight=this.canvasContainer.clientHeight,f(this.maskCanvas,{width:this.boxWidth,height:this.boxHeight}),f(this.baseCanvas,{width:this.boxWidth,height:this.boxHeight})};activeWindow=(e,t)=>{if(this.broadcastChannel.postMessage({type:`activeWindow`,act:t,id:this.id,x:e.clientX,y:e.clientY}),this.mode===`otherTab`){this.selectHeight||this.selectWidth?this.mode=`waitEdit`:this.mode=`select`;return}};drawMask=()=>{this.maskCtx.clearRect(0,0,this.boxWidth,this.boxHeight),this.maskCtx.fillStyle=`rgba(0, 0, 0, 0.5)`,this.maskCtx.fillRect(0,0,this.boxWidth,this.boxHeight),this.selectWidth&&this.selectHeight?(this.maskCtx.clearRect(this.selectX,this.selectY,this.selectWidth,this.selectHeight),this.canvasContainer.appendChild(this.selectRectDom),this.selectRectDom.style.left=`${this.selectX-2}px`,this.selectRectDom.style.top=`${this.selectY-2}px`,this.selectRectDom.style.width=`${this.selectWidth}px`,this.selectRectDom.style.height=`${this.selectHeight}px`):this.selectRectDom.remove()};selectStart=e=>{this.mode===`select`&&(this.isSelecting=!0,this.startX=e.clientX,this.startY=e.clientY,console.log(`%cðŸŽ„ select start`,`background-color: #00b548; color: #fff;padding: 2px 4px;border-radius: 2px;`,this.startX,this.startY))};selectMove=e=>{if(this.mode!==`select`)return;if(!this.isSelecting){let t=s({x:e.clientX,y:e.clientY,windows:this.windows});if(this.matchedWindow=t,!t){this.matchedWindow=void 0;return}this.selectX=t.x,this.selectY=t.y,this.selectWidth=t.width,this.selectHeight=t.height,this.drawMask();return}let{top:t,left:n,width:r,height:a}=i({startX:this.startX,startY:this.startY,moveX:e.clientX-this.startX,moveY:e.clientY-this.startY,maxX:this.boxWidth,maxY:this.boxHeight});this.selectX=n,this.selectY=t,this.selectWidth=r,this.selectHeight=a,this.drawMask()};selectEnd=()=>{this.mode===`select`&&(this.isSelecting=!1,this.mode=`waitEdit`)};resizeStart=e=>{if(this.mode!==`select`)if(e.target?.classList?.contains(`resize-handle`)){this.resizeHandle=e.target.dataset.role||``,this.mode=`resizing`;let t=getComputedStyle(e.target).cursor||``;this.canvasContainer.style.cursor=t,this.selectRectDom.style.cursor=t,this.startX=e.clientX,this.startY=e.clientY;let{x:n,y:r}=a({resizeHandle:this.resizeHandle,x:this.selectX,y:this.selectY,width:this.selectWidth,height:this.selectHeight});this.fixedX=n,this.fixedY=r,this.fixedWidth=this.selectWidth,this.fixedHeight=this.selectHeight}else e.target?.classList?.contains(`select-rect`)&&(this.mode=`move`,this.startX=e.clientX,this.startY=e.clientY,this.fixedX=this.selectX,this.fixedY=this.selectY,this.fixedWidth=this.selectWidth,this.fixedHeight=this.selectHeight)};resizeMove=e=>{if(this.mode!==`select`){if(this.mode===`resizing`&&this.resizeHandle){let{top:t,left:n,width:r,height:i}=o({resizeHandle:this.resizeHandle,fixedX:this.fixedX,fixedY:this.fixedY,originWidth:this.fixedWidth,originHeight:this.fixedHeight,moveX:e.clientX-this.startX,moveY:e.clientY-this.startY,maxX:this.boxWidth,maxY:this.boxHeight});this.selectX=n,this.selectY=t,this.selectWidth=r,this.selectHeight=i,this.drawMask()}else if(this.mode===`move`){let t=e.clientX-this.startX,n=e.clientY-this.startY,r=this.fixedX+t,i=this.fixedY+n;(r<0||r+this.fixedWidth>this.boxWidth)&&(this.fixedX=this.selectX,this.fixedWidth=this.selectWidth,this.startX=e.clientX),(i<0||i+this.fixedHeight>this.boxHeight)&&(this.fixedY=this.selectY,this.fixedHeight=this.selectHeight,this.startY=e.clientY),r<0?r=0:r+this.fixedWidth>this.boxWidth&&(r=this.boxWidth-this.fixedWidth),i<0?i=0:i+this.fixedHeight>this.boxHeight&&(i=this.boxHeight-this.fixedHeight),this.selectX=r,this.selectY=i,this.drawMask()}}};resizeEnd=()=>{this.mode!==`select`&&(this.mode=`waitEdit`,this.resizeHandle=``)};onMouseDown=e=>{if(this.mode===`edit`||this.mode===`forbidden`||(this.activeWindow(e,`selectStart`),this.mode===`otherTab`))return;let t=e.target===this.selectRectDom||this.selectRectDom.contains(e.target);this.editTools.render(this.mode===`waitEdit`&&!t,{x:this.selectX,y:this.selectY,width:this.selectWidth,height:this.selectHeight}),this.mode===`select`?this.selectStart(e):this.resizeStart(e)};onMouseMove=e=>{this.mode===`edit`||this.mode===`forbidden`||(this.activeWindow(e,`move`),this.mode!==`otherTab`&&(this.mode===`select`?(this.selectMove(e),this.sizeDisplay.render(!0,{x:this.selectX,y:this.selectY,width:this.selectWidth,height:this.selectHeight})):(this.resizeMove(e),this.sizeDisplay.render(!0,{x:this.selectX,y:this.selectY,width:this.selectWidth,height:this.selectHeight}))))};onMouseUp=e=>{if(!(this.mode===`edit`||this.mode===`forbidden`)&&(this.activeWindow(e,`selectEnd`),this.mode!==`otherTab`))switch(this.mode){case`select`:e.stopPropagation(),e.preventDefault(),console.log(`mouseup selectEnd`,this.selectWidth,this.selectHeight,this.matchedWindow),this.selectWidth<=10&&this.selectHeight<=10&&this.matchedWindow&&(this.selectX=this.matchedWindow.x,this.selectY=this.matchedWindow.y,this.selectWidth=this.matchedWindow.width,this.selectHeight=this.matchedWindow.height),this.selectWidth&&this.selectHeight?(this.selectEnd(),this.editTools.render(!0,{x:this.selectX,y:this.selectY,width:this.selectWidth,height:this.selectHeight}),this.drawMask()):(this.matchedWindow&&(this.selectX=this.matchedWindow.x,this.selectY=this.matchedWindow.y,this.selectWidth=this.matchedWindow.width,this.selectHeight=this.matchedWindow.height),this.drawMask(),this.isSelecting=!1);break;case`waitEdit`:case`move`:case`resizing`:e.stopPropagation(),e.preventDefault(),this.resizeEnd(),this.editTools.render(!0,{x:this.selectX,y:this.selectY,width:this.selectWidth,height:this.selectHeight});break;default:break}};onMouseLeave=e=>{if(this.mode===`move`){let t=e.clientX,n=e.clientY;t>this.boxWidth?this.selectX=this.boxWidth-this.selectWidth:t<0&&(this.selectX=0),n>this.boxHeight?this.selectY=this.boxHeight-this.selectHeight:n<0&&(this.selectY=0),this.fixedX=this.selectX,this.fixedY=this.selectY,this.fixedWidth=this.selectWidth,this.fixedHeight=this.selectHeight,this.startX=e.clientX,this.startY=e.clientY,this.drawMask()}};onMouseEnter=e=>{this.mode===`edit`||this.mode===`forbidden`||this.activeWindow(e,`enter`)};initListener=()=>{document.body.addEventListener(`mousedown`,this.onMouseDown),document.body.addEventListener(`mousemove`,this.onMouseMove),document.body.addEventListener(`mouseup`,this.onMouseUp),document.body.addEventListener(`mouseleave`,this.onMouseLeave),document.body.addEventListener(`mouseenter`,this.onMouseEnter),x(this.selectRectDom,()=>{console.log(`================double click================`),this.setEditCanvasBg(),this.editCanvas.writeToClipboard()})};putImageData=({imageData:e,width:t,height:n})=>{this.imgNaturalWidth=t,this.imgNaturalHeight=n;let r=this.imgNaturalWidth/this.boxWidth,i=this.imgNaturalHeight/this.boxHeight,a=Math.max(r,i);this.imgDrawWidth=this.imgNaturalWidth/a,this.imgDrawHeight=this.imgNaturalHeight/a,this.imgOffsetX=(this.boxWidth-this.imgDrawWidth)/2,this.imgOffsetY=(this.boxHeight-this.imgDrawHeight)/2,this.baseCtx.putImageData(e,0,0)}},N=document.querySelector(`#app`);function P(){console.log(`Environment mode:`,`production`),console.log(`Is development:`,!1),console.log(`Is production:`,!0);let e=new M(N);console.log(`ðŸš€ ~ init ~ drawScreen:`,e),window.drawScreen=e,r().then(t=>{e.putImageData(t)}).catch(e=>console.error(e)),window.addEventListener(`keydown`,e=>{e.key===`Escape`&&n()})}P();</script>
  <style rel="stylesheet" crossorigin>:root{color:#ffffffde;font-synthesis:none;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;--resize-handle-size:5px;--select-color:#00c6db;font-family:system-ui,Avenir,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.5}*{box-sizing:border-box;-webkit-user-select:none;user-select:none;margin:0;padding:0}html,body{-webkit-user-select:none;user-select:none;background-color:#0000;width:100%;height:100%;overflow:hidden}#app{-webkit-user-select:none;user-select:none;background-color:#0000;width:100%;height:100%;position:relative}#app img{-o-object-fit:contain;object-fit:contain;max-width:100%;max-height:100%}.canvas-container{z-index:100;-webkit-user-select:none;user-select:none;width:100%;height:100%;position:absolute;top:0;left:0;overflow:hidden}canvas{-webkit-user-select:none;user-select:none;image-rendering:-webkit-optimize-contrast;image-rendering:crisp-edges;image-rendering:pixelated;display:block}.mask-canvas{z-index:200;width:100%;height:100%;position:absolute;top:0;left:0}.select-rect{z-index:300;border:2px solid var(--select-color);box-sizing:content-box;position:absolute;transform:translate(0,0)}.resize-handle{width:var(--resize-handle-size);height:var(--resize-handle-size);background-color:var(--select-color);-webkit-user-select:none;user-select:none;position:absolute}.resize-top-left{top:calc(var(--resize-handle-size)/-2);left:calc(var(--resize-handle-size)/-2);cursor:nwse-resize}.resize-top{top:calc(var(--resize-handle-size)/-2);cursor:ns-resize;left:50%;transform:translate(-50%)}.resize-top-right{top:calc(var(--resize-handle-size)/-2);right:calc(var(--resize-handle-size)/-2);cursor:nesw-resize}.resize-right{right:calc(var(--resize-handle-size)/-2);cursor:ew-resize;top:50%;transform:translateY(-50%)}.resize-bottom-right{right:calc(var(--resize-handle-size)/-2);bottom:calc(var(--resize-handle-size)/-2);cursor:nwse-resize}.resize-bottom{bottom:calc(var(--resize-handle-size)/-2);cursor:ns-resize;left:50%;transform:translate(-50%)}.resize-bottom-left{bottom:calc(var(--resize-handle-size)/-2);left:calc(var(--resize-handle-size)/-2);cursor:nesw-resize}.resize-left{top:50%;left:calc(var(--resize-handle-size)/-2);cursor:ew-resize;transform:translateY(-50%)}.edit-mode .resize-handle{cursor:default}.resize-assist{z-index:400;border:1px dashed #00000080;position:absolute}.resize-assist-handle{width:var(--resize-handle-size);height:var(--resize-handle-size);background-color:#ffffff80;border-radius:50%;position:absolute}.edit-tool{-webkit-user-select:none;user-select:none;z-index:400;visibility:hidden;background-color:#fff;border-radius:4px;justify-content:center;align-items:center;width:fit-content;padding:6px 14px;display:flex;position:absolute;bottom:0;right:0;box-shadow:0 2px 8px #00000026}.edit-tool-group{justify-content:center;align-items:center;gap:12px;display:flex}.edit-tool-group:after{content:"";background-color:#e5e6eb;width:1px;height:20px;margin-right:12px;display:block}.edit-tool-group:last-child:after{display:none}.edit-tool-item{-webkit-user-select:none;user-select:none;cursor:pointer;color:#000;--active-color:#0d1324;border-radius:2.4px;justify-content:center;align-items:center;width:28px;height:28px;display:flex}.edit-tool-item.active{--active-color:#00c6db;background-color:#f5f5f5}.edit-tool-item .wrap{justify-content:center;align-items:center;width:100%;height:100%;display:flex}.edit-tool-item .normal{display:block}.edit-tool-item .active,.edit-tool-item.active .normal{display:none}.edit-tool-item.active .active{display:block}.edit-tool-item svg{-webkit-user-select:none;user-select:none}.edit-tool-item:hover{background-color:#f5f5f5}.size-display{-webkit-user-select:none;user-select:none;z-index:400;color:#fff;visibility:hidden;justify-content:center;align-items:center;gap:2px;width:fit-content;height:20px;padding:0 2px;display:flex;position:absolute;bottom:0;left:0}
/*$vite$:1*/</style>
</head><body><div id="app"></div></body></html>